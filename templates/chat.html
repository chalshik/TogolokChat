<!DOCTYPE html>
<html lang="ky">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TogolokChat</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="/static/css/chat.css">
    <link rel="stylesheet" href="/static/css/sidebar-views.css">
    <link rel="stylesheet" href="/static/css/modal.css">
    <style>
        /* Additional modal debugging styles */
        #test-modal {
            z-index: 999999 !important;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <!-- Left Sidebar -->
        <div class="sidebar">
            <!-- Sidebar Header (Logo/User Info - Keep or adjust as needed) -->
            <div class="sidebar-header" id="sidebar-header">
                <img src="/static/images/logo.png" alt="Logo" class="logo-icon">
                <span class="logo-text">TogolokChat</span>
                <div class="header-actions">
                    <button id="logout-btn" title="Logout">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>

            <!-- Dynamic Content Area -->
            <div id="sidebar-content-area">
                <!-- Sidebar views will be loaded dynamically by JavaScript -->
            </div>

            <!-- Bottom Navigation -->
            <nav class="sidebar-nav" style="display: flex; justify-content: space-around;">
                <button class="nav-item" data-view="create-group" title="New Group">
                    <i class="fas fa-users"></i>
                </button>
                <button class="nav-item" data-view="settings" title="Settings">
                    <i class="fas fa-cog"></i>
                </button>
                <button class="nav-item" data-view="add-contact" title="Add Contact">
                    <i class="fas fa-user-plus"></i>
                </button>
                <button class="nav-item" data-view="profile" title="Profile">
                    <i class="fas fa-user"></i>
                </button>
            </nav>
        </div>

        <!-- Main Chat Area -->
        <div class="main-chat">
            <!-- Chat Header -->
            <div class="chat-header" id="chat-header">
                <div class="chat-info">
                    <div class="chat-avatar">
                        <img src="/static/images/group_icon.png" alt="Current Chat" id="current-chat-avatar">
                    </div>
                    <div class="chat-details">
                        <h2 id="current-chat-title">AIT-CS'24</h2>
                        <p id="current-chat-subtitle">–≠–º–∏–ª –ê–≥–∞–π, –ú—É—Ä–∞—Ç –ê–≥–∞–π, –ù—É—Ä–º—É—Ö–∞–º–º–µ–¥, –ê–∫–±–∞—Ä, –´–Ω—Ç—ã–º–∞–∫...</p>
                    </div>
                </div>
                <div class="chat-actions">
                    <i class="fas fa-search"></i>
                    <i class="fas fa-ellipsis-v"></i>
                </div>
            </div>

            <!-- Messages Area -->
            <div class="messages-container" id="group1-messages">
                <!-- Group 1 messages -->
                <div class="message received">
                    <div class="message-avatar">
                        <img src="/static/images/contact_logo.png" alt="User">
                    </div>
                    <div class="message-content">
                        <div class="message-info">
                            <span class="sender-name">–ù—É—Ä–º—É—Ö–∞–º–º–µ–¥</span>
                            <span class="message-time">12:38 AM</span>
                        </div>
                        <p>–ö–ª–∞—Å—Å–∏–∫–∞–≥–∞ –∫–æ—à—É–º—á–∞ –±–∞–ª–ª –±–µ—Ä–∏–ª–µ–±“Ø?</p>
                    </div>
                </div>

                <div class="message sent">
                    <div class="message-content">
                        <div class="message-info">
                            <span class="message-time">12:39 AM</span>
                            <span class="message-status">
                                <i class="fas fa-check-double"></i>
                            </span>
                        </div>
                        <p>–û–æ, –∫—Ä–µ–∞—Ç–∏–≤–¥“Ø“Ø üòä</p>
                    </div>
                </div>
                
                <div class="message received">
                    <div class="message-avatar">
                        <img src="/static/images/contact_logo.png" alt="User">
                    </div>
                    <div class="message-content">
                        <div class="message-info">
                            <span class="sender-name">–¢–æ–≥–æ–ª–æ–∫—Ç–∞–∫—Ç(3)</span>
                            <span class="message-time">10:44 AM</span>
                        </div>
                        <p>–ë“Ø–≥“Ø–Ω —Å–∞–±–∞–∫—Ç–∞—Ä –±–æ–ª–±–æ–π—Ç</p>
                    </div>
                </div>
                
                <div class="message received">
                    <div class="message-avatar">
                        <img src="/static/images/contact_logo.png" alt="User">
                    </div>
                    <div class="message-content">
                        <div class="message-info">
                            <span class="sender-name">–¢–æ–≥–æ–ª–æ–∫—Ç–∞–∫—Ç(1)</span>
                            <span class="message-time">10:59 AM</span>
                        </div>
                        <p><a href="https://meet.google.com/kvi-foaa-cwy" class="message-link">https://meet.google.com/kvi-foaa-cwy</a></p>
                    </div>
                </div>
            </div>
            
            <!-- User 1 messages - initially hidden -->
            <div class="messages-container" id="user1-messages" style="display: none;">
                <div class="message received">
                    <div class="message-avatar">
                        <img src="/static/images/contact_logo.png" alt="User">
                    </div>
                    <div class="message-content">
                        <div class="message-info">
                            <span class="sender-name">–ù—É—Ä–º—É—Ö–∞–º–º–µ–¥</span>
                            <span class="message-time">11:44 PM</span>
                        </div>
                        <p>–ë–∏–∑ —ç–º–Ω–µ –∫—ã–ª–∞–±—ã–∑?</p>
                    </div>
                </div>
                
                <div class="message sent">
                    <div class="message-content">
                        <div class="message-info">
                            <span class="message-time">11:51 PM</span>
                            <span class="message-status">
                                <i class="fas fa-check-double"></i>
                            </span>
                        </div>
                        <p>–°–∞–±–∞–∫ –±–∞—à—Ç–∞–ª–¥—ã–±—ã?</p>
                    </div>
                </div>
                
                <div class="message received">
                    <div class="message-avatar">
                        <img src="/static/images/contact_logo.png" alt="User">
                    </div>
                    <div class="message-content">
                        <div class="message-info">
                            <span class="sender-name">–ù—É—Ä–º—É—Ö–∞–º–º–µ–¥</span>
                            <span class="message-time">9:00 AM</span>
                        </div>
                        <p>–ê–∞, –º–µ–Ω –¥–∞ –∫–µ—Ç—Ç–∞–º, —Ç—ã–≥—ã–º —ç–∫–µ–Ω –±—É–ª –∂–µ—Ä–ª–µ—Ä</p>
                    </div>
                </div>
                
                <div class="message received">
                    <div class="message-avatar">
                        <img src="/static/images/contact_logo.png" alt="User">
                    </div>
                    <div class="message-content">
                        <div class="message-info">
                            <span class="sender-name">–ù—É—Ä–º—É—Ö–∞–º–º–µ–¥</span>
                            <span class="message-time">10:44 AM</span>
                        </div>
                        <p>–ë–∞—à—Ç–∞–ª—Å–∞ –º–∞–≥–∞ –∂–∞–∑—ã–ø –∫–æ–π—á—É</p>
                    </div>
                </div>
            </div>

            <!-- Input Area -->
            <div class="input-container">
                <div class="input-actions">
                    <i class="far fa-smile"></i>
                    <i class="fas fa-paperclip"></i>
                </div>
                <div class="input-box">
                    <input type="text" placeholder="–ö–∞–±–∞—Ä—ã“£—ã–∑–¥—ã –∂–∞–∑—ã“£—ã–∑">
                </div>
                <div class="send-button">
                    <i class="fas fa-paper-plane"></i>
                </div>
            </div>
        </div>
        
        <!-- Group Profile Sidebar -->
        <div class="profile-sidebar" id="group-profile-sidebar">
            <div class="profile-header">
                <div class="close-btn" id="close-group-profile">
                    <i class="fas fa-times"></i>
                </div>
                <div class="group-info">
                    <div class="group-avatar" id="edit-group-avatar">
                        <img src="/static/images/group_icon.png" alt="Group" id="group-avatar-img">
                        <div class="edit-overlay">
                            <i class="fas fa-camera"></i>
                        </div>
                    </div>
                    <div class="group-name">
                        <h2 id="group-name-display">AIT-CS'24</h2>
                        <a href="#" class="edit-group" id="edit-group-name"><i class="fas fa-pen"></i></a>
                    </div>
                    <div class="group-members-count">
                        –ö–∞—Ç—ã—à—É—É—á—É–ª–∞—Ä–¥—ã–Ω —Å–∞–Ω—ã: 60
                    </div>
                </div>
            </div>
            
            <div class="members-list">
                <div class="member">
                    <div class="member-avatar">
                        <img src="/static/images/contact_logo.png" alt="User">
                    </div>
                    <div class="member-name">–≠–º–∏–ª –ê–≥–∞–π</div>
                </div>
                
                <div class="member">
                    <div class="member-avatar">
                        <img src="/static/images/contact_logo.png" alt="User">
                    </div>
                    <div class="member-name">–ú—É—Ä–∞—Ä–∞ –≠–∂–µ–∫–µ</div>
                </div>
                
                <div class="member">
                    <div class="member-avatar">
                        <img src="/static/images/contact_logo.png" alt="User">
                    </div>
                    <div class="member-name">–£–ª–∞–Ω –ê–≥–∞–π</div>
                </div>
                
                <div class="member">
                    <div class="member-avatar">
                        <div class="online-indicator"></div>
                        <img src="/static/images/contact_logo.png" alt="User">
                    </div>
                    <div class="member-name">–ù—É—Ä–º—É—Ö–∞–º–º–µ–¥</div>
                </div>
                
                <div class="member">
                    <div class="member-avatar">
                        <img src="/static/images/contact_logo.png" alt="User">
                    </div>
                    <div class="member-name">–ê–∫–±–∞—Ä</div>
                </div>
                
                <div class="member">
                    <div class="member-avatar">
                        <img src="/static/images/contact_logo.png" alt="User">
                    </div>
                    <div class="member-name">–´–Ω—Ç—ã–º–∞–∫</div>
                </div>
                
                <div class="member">
                    <div class="member-avatar">
                        <img src="/static/images/contact_logo.png" alt="User">
                    </div>
                    <div class="member-name">–ê—Ç–∞–±–µ–∫</div>
                </div>
                
                <div class="member">
                    <div class="member-avatar">
                        <img src="/static/images/contact_logo.png" alt="User">
                    </div>
                    <div class="member-name">–ù—É—Ä—Ç–∏–ª–µ–∫</div>
                </div>
            </div>
            
            <div class="profile-actions">
                <button class="action-btn leave-group">
                    <i class="fas fa-sign-out-alt"></i> –ß—ã–≥—É—É
                </button>
                <button class="action-btn add-member">
                    <i class="fas fa-user-plus"></i> –ö–æ—à—É—É
                </button>
            </div>
        </div>
        
        <!-- Contact Profile Sidebar -->
        <div class="profile-sidebar" id="contact-profile-sidebar">
            <div class="profile-header">
                <div class="close-btn" id="close-contact-profile">
                    <i class="fas fa-times"></i>
                </div>
                <div class="contact-info">
                    <div class="contact-avatar" id="contact-avatar">
                        <img src="/static/images/contact_logo.png" alt="Contact" id="contact-avatar-img">
                    </div>
                    <div class="contact-name">
                        <h2 id="contact-name-display">–ù—É—Ä–º—É—Ö–∞–º–º–µ–¥</h2>
                        <a href="#" class="edit-contact" id="edit-contact-name"><i class="fas fa-pen"></i></a>
                    </div>
                    <div class="contact-nickname">
                        ~Jaman_bala
                    </div>
                </div>
            </div>
            
            <div class="contact-details">
                <h3>–ú–∞–∞–ª—ã–º–∞—Ç:</h3>
                <p id="contact-info-text">
                    –¢–æ–≥–æ–ª–æ–∫–ß–∞—Ç—Ç—ã –Ω”©–ª–¥”©–Ω –∂–∞—Å–∞–ø —á—ã–∫–∫–∞–Ω –∏—à—Ç–µ–ø—á—ã–≥—É—É—á—É –º—ã–Ω–∞ –º–µ–Ω –±–æ–ª–æ–º, –∞—Ç—ã-–∂”©–Ω“Ø–º –ù—É—Ä–º—É—Ö–∞–º–º–µ–¥ –ö–∞–ª–º–∞–º–∞—Ç–æ–≤, –ñ–ê–ú–ê–ù –ë–ê–õ–ê
                </p>
            </div>
            
            <div class="profile-actions contact-actions">
                <button class="action-btn report-contact">
                    <i class="fas fa-flag"></i> –î–∞—Ç—Ç–∞–Ω—É—É
                </button>
            </div>
        </div>
        
        <!-- Edit Group Name Modal -->
        <div class="modal" id="edit-name-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>–ì—Ä—É–ø–ø–∞ –∞—Ç–∞–ª—ã—à—ã–Ω ”©–∑–≥”©—Ä—Ç“Ø“Ø</h3>
                    <span class="modal-close">&times;</span>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="group-name-input-1">–ñ–∞“£—ã –∞—Ç–∞–ª—ã—à:</label>
                        <input type="text" id="group-name-input-1" class="form-control" placeholder="–ì—Ä—É–ø–ø–∞–Ω—ã–Ω –∞—Ç–∞–ª—ã—à—ã–Ω –∫–∏—Ä–≥–∏–∑–∏“£–∏–∑">
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn cancel-btn">–ñ–æ–∫–∫–æ —á—ã–≥–∞—Ä—É—É</button>
                    <button class="btn save-btn" id="save-name-btn">–°–∞–∫—Ç–æ–æ</button>
                </div>
            </div>
        </div>
        
        <!-- Edit Group Avatar Modal -->
        <div class="modal" id="edit-avatar-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>–ì—Ä—É–ø–ø–∞ —Å“Ø—Ä”©—Ç“Ø–Ω ”©–∑–≥”©—Ä—Ç“Ø“Ø</h3>
                    <span class="modal-close">&times;</span>
                </div>
                <div class="modal-body">
                    <div class="avatar-upload">
                        <div class="avatar-preview">
                            <img src="/static/images/group_icon.png" id="avatar-preview-img" alt="Preview">
                        </div>
                        <div class="avatar-options">
                            <button class="btn upload-btn">
                                <i class="fas fa-upload"></i> –°“Ø—Ä”©—Ç —Ç–∞–Ω–¥–æ–æ
                                <input type="file" id="avatar-upload" accept="image/*" hidden>
                            </button>
                            <button class="btn remove-btn" id="remove-avatar-btn">
                                <i class="fas fa-trash"></i> –°“Ø—Ä”©—Ç—Ç“Ø –∞–ª—ã–ø —Å–∞–ª—É—É
                            </button>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn cancel-btn">–ñ–æ–∫–∫–æ —á—ã–≥–∞—Ä—É—É</button>
                    <button class="btn save-btn" id="save-avatar-btn">–°–∞–∫—Ç–æ–æ</button>
                </div>
            </div>
        </div>
        
        <!-- Edit Contact Name Modal -->
        <div class="modal" id="edit-contact-name-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>–ê—Ç–∞–ª—ã—à—ã–Ω ”©–∑–≥”©—Ä—Ç“Ø“Ø</h3>
                    <span class="modal-close">&times;</span>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="contact-name-input">–ñ–∞“£—ã –∞—Ç–∞–ª—ã—à:</label>
                        <input type="text" id="contact-name-input" class="form-control" placeholder="–ê—Ç–∞–ª—ã—à—ã–Ω –∫–∏—Ä–≥–∏–∑–∏“£–∏–∑">
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn cancel-btn">–ñ–æ–∫–∫–æ —á—ã–≥–∞—Ä—É—É</button>
                    <button class="btn save-btn" id="save-contact-name-btn">–°–∞–∫—Ç–æ–æ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Group Edit Modals (Add near the end of body) -->
    <div id="edit-group-name-modal" class="modal" style="display: none !important;">
        <div class="modal-content">
            <span class="close-modal-btn">&times;</span>
            <h3>–ê—Ç–∞–ª—ã—à—ã–Ω ”©–∑–≥”©—Ä—Ç“Ø“Ø</h3>
            <label for="group-name-input-2">–ñ–∞“£—ã –∞—Ç–∞–ª—ã—à:</label>
            <input type="text" id="group-name-input-2" placeholder="–ì—Ä—É–ø–ø–∞–Ω—ã–Ω –∂–∞“£—ã –∞—Ç—ã">
            <div class="modal-actions">
                 <button id="cancel-group-name-btn" class="btn btn-secondary">–ñ–æ–∫–∫–æ —á—ã–≥–∞—Ä—É—É</button>
                <button id="save-group-name-btn" class="btn btn-primary">–°–∞–∫—Ç–æ–æ</button>
            </div>
        </div>
    </div>

    <div id="edit-group-avatar-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-modal-btn">&times;</span>
            <h3>–ì—Ä—É–ø–ø–∞ —Å“Ø—Ä”©—Ç“Ø–Ω ”©–∑–≥”©—Ä—Ç“Ø“Ø</h3>
            <div class="avatar-upload-area">
                <img src="/static/images/group_icon.png" alt="Current Avatar" id="group-avatar-preview" class="avatar-preview">
                <label for="group-avatar-upload" class="btn btn-secondary">–°“Ø—Ä”©—Ç —Ç–∞–Ω–¥–æ–æ</label>
                <input type="file" id="group-avatar-upload" accept="image/*" style="display: none;">
                 <button id="remove-group-avatar-btn" class="btn btn-danger">–°“Ø—Ä”©—Ç—Ç“Ø ”©—á“Ø—Ä“Ø“Ø</button>
            </div>
             <div class="modal-actions">
                 <button id="cancel-group-avatar-btn" class="btn btn-secondary">–ñ–æ–∫–∫–æ —á—ã–≥–∞—Ä—É—É</button>
                 <button id="save-group-avatar-btn" class="btn btn-primary">–°–∞–∫—Ç–æ–æ</button>
             </div>
        </div>
    </div>
    <!-- End Group Edit Modals -->

    <!-- Code injected by live-server -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Replace incorrect Fontawesome kit with CDN link -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    
    <!-- Socket.IO client library -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    
    <!-- Mock sidebar template for chats view in case server doesn't return it -->
    <script id="mock-chats-template" type="text/template">
        <div id="chats-view" class="sidebar-view active">
            <div class="view-header">
                <h2>–ú–∞–µ–∫—Ç–µ—Ä</h2>
                <div class="search-box">
                    <input type="text" id="chat-search-input" placeholder="–ò–∑–¥”©”©...">
                    <i class="fas fa-search"></i>
                </div>
            </div>
            <div class="chat-list-container scrollable-list">
                <div id="chat-list" class="chat-list">
                    <!-- Chat items will be added here -->
                </div>
            </div>
        </div>
    </script>
    
    <!-- Main chat script -->
    <script src="{{ url_for('static', filename='js/chat.js') }}"></script>
    <script>
        // Wait for the chat.js script to fully load before trying to use its functions
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM content loaded, initializing chat app...");
            
            // Pass server-side username to client
            window.currentUsername = "{{ session.get('username', '') }}";
            if (window.currentUsername) {
                console.log("Setting current username:", window.currentUsername);
                sessionStorage.setItem('username', window.currentUsername);
            } else {
                console.warn("Username not found in session");
            }
            
            // Hide all modals on page load
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                modal.style.display = 'none';
            });
            
            // Give the chat.js script time to load and execute
            setTimeout(function() {
                // Check if sidebar content area exists
                const sidebarContentArea = document.getElementById('sidebar-content-area');
                if (sidebarContentArea) {
                    console.log("Sidebar content area found, loading chats view");
                    
                    // Try to load the default sidebar view
                    if (typeof window.loadSidebarView === 'function') {
                        console.log("Using loadSidebarView function");
                        window.loadSidebarView('chats').catch(error => {
                            console.error("Error loading sidebar view:", error);
                            console.log("Falling back to direct DOM manipulation");
                            // Fallback: Insert mock template
                            const mockTemplate = document.getElementById('mock-chats-template');
                            if (mockTemplate) {
                                sidebarContentArea.innerHTML = mockTemplate.innerHTML;
                                // Try to load contacts directly
                                if (typeof window.loadUserContacts === 'function') {
                                    window.loadUserContacts();
                                }
                            }
                        });
                    } else {
                        console.error("loadSidebarView function not found, using direct DOM manipulation");
                        // Insert mock template
                        const mockTemplate = document.getElementById('mock-chats-template');
                        if (mockTemplate) {
                            sidebarContentArea.innerHTML = mockTemplate.innerHTML;
                            // Try to load contacts directly
                            if (typeof window.loadUserContacts === 'function') {
                                window.loadUserContacts();
                            }
                        }
                    }
                } else {
                    console.error("Sidebar content area not found");
                }
            }, 500); // Give half a second delay to ensure scripts are loaded
        });
    </script>
</body>
</html> 